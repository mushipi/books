# 自宅の本管理アプリ

自宅の蔵書を効率的に管理するためのウェブベースアプリケーションです。本のバーコード（JANコード/ISBN）から情報を取得し、データベースで一元管理します。

## 機能

- JANコード/ISBNの画像からの自動読み取り
- 外部APIを利用した書籍情報の自動取得
- 書籍の基本情報管理（追加・編集・削除）
- 検索・ソート機能
- カテゴリ/タグ管理
- 収納場所管理
- データエクスポート（CSV/JSON）

## セットアップ方法

### 1. 仮想環境のセットアップ

アプリケーションをセットアップするには、まず `setup_env.bat` スクリプトを実行して必要なライブラリをインストールしてください：

```
setup_env.bat
```

これにより、Python仮想環境が作成され、必要なパッケージがインストールされます。

### 2. データベースの初期化

次に、データベースを初期化するために `db_init.py` スクリプトを実行します：

```
call venv\Scripts\activate
python db_init.py
```

プロンプトが表示されたら、`3` を選択して「初期化+初期データ投入」を実行してください。

### 3. アプリケーションの起動

最後に、アプリケーションを起動します：

```
python app.py
```

ブラウザで `http://localhost:5000` にアクセスしてアプリケーションを使用開始できます。

## ネットワーク公開

ローカルネットワーク内で他のデバイスからアクセスできるようにするには、以下の手順に従ってください：

1. ホストPCのIPアドレスを確認します（コマンドプロンプトで `ipconfig` を実行）
2. アプリケーションは既に `0.0.0.0` アドレスでリッスンするよう設定されています
3. 必要に応じてファイアウォール設定を確認し、ポート5000を開放します
4. 同じネットワーク内の他のデバイスから `http://<ホストIP>:5000` でアクセスできます

## 使用技術

- Flask（Pythonウェブフレームワーク）
- Bootstrap 5（レスポンシブUI）
- SQLite（データベース）
- OpenBD API / 国立国会図書館API（書籍情報取得）
- pyzbar/OpenCV（バーコード処理）

## 表紙画像表示の仕組み

本アプリケーションでは、表紙画像を表示するために以下の仕組みを実装しています：

1. **直接アクセス方式**
   - `/direct-cover/<ファイル名>` 経由で画像を取得
   - 例: `http://100.64.1.92:5000/direct-cover/9784798171944.jpg`

2. **絶対パスアクセス方式**
   - `/absolute-cover/<ファイル名>` 経由で画像を取得
   - 例: `http://100.64.1.92:5000/absolute-cover/9784798171944.jpg`

3. **APIアクセス方式**
   - `/api/cover-info/<ファイル名>` で画像情報をJSON形式で取得
   - 例: `http://100.64.1.92:5000/api/cover-info/9784798171944.jpg`

## 画像の自動取得機能

新しい書籍を登録する際、以下の手順で表紙画像が自動的に取得されます：

1. ISBNが入力された場合、OpenBD APIから表紙画像を取得
2. 取得できた画像は `static/covers` ディレクトリにISBN名で保存
3. 既存の表紙画像は `find_cover_by_isbn()` 関数で検索されます

## 注意事項

- このアプリケーションは開発者の個人的な使用を想定しています
- 外部APIの利用制限に注意してください
- 大量の書籍データを扱う場合はSQLiteではなくより堅牢なデータベースへの移行を検討してください
- サーバーをローカルネットワーク外に公開する場合は、適切なセキュリティ対策を講じてください

## トラブルシューティング

### 表紙画像が表示されない場合

1. `static/covers` ディレクトリにファイルが存在するか確認
2. `/direct-cover/<ファイル名>` で直接アクセスしてみる
3. `diagnose_covers.bat` を実行して表紙画像の状態を確認

### バーコード読み取り機能が動作しない場合

1. `fix_dependencies.bat` を実行して依存関係を修正
2. `start_app_without_barcode.bat` でバーコード機能を無効化して起動

### Gemini API機能を利用したい場合

1. APIキーを環境変数 `GEMINI_API_KEY` に設定
2. `install_gemini_api.bat` を実行して必要なライブラリをインストール
3. `start_app_gemini_new.bat` で起動

## 開発者情報

- 開発者: Personal Project
- 作成日: 2024年
- 最終更新: 2025年5月5日

---

このアプリケーションは個人向けの蔵書管理を目的としており、一般公開や商業利用を想定したものではありません。
